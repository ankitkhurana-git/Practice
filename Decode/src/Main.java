import java.util.Arrays;

import com.google.gson.Gson;
import com.google.gson.JsonObject;

public class Main {
	private static JsonObject jsonObject = new JsonObject();
	private static SipData sipData = new SipData();

	public static void main(String[] args) {

		String stringData = binaryToText(
				"0101001001000101010001110100100101010011010101000100010101010010001000000111001101101001011100000011101001110011011010010111000000101110011000110111100101100010011001010111001001100011011010010111010001111001001011100110010001101011001000000101001101001001010100000010111100110010001011100011000000001010010101100110100101100001001110100010000001010011010010010101000000101111001100100010111000110000001011110101010101000100010100000010000000110001001110010011001000101110001100010011011000111000001011100011000100101110001100100011101101100010011100100110000101101110011000110110100000111101011110100011100101101000010001110011010001100010010010110110111001110000001101100011001000111001001100010011001100110110001101100011010100101101001101000011001100110000011000010110000100110010011001000110000100110001001110010011001000101110001100010011011000111000001011100011000100101110001100100011101101110010011100000110111101110010011101000000101001000110011100100110111101101101001110100010000000111100011100110110100101110000001110100111011001101111011010010011000100111000001100000011011000110010010000000111001101101001011100000010111001100011011110010110001001100101011100100110001101101001011101000111100100101110011001000110101100111110001110110111010001100001011001110011110100110011011000100110011001100110011000110110001101100011000010100101010001101111001110100010000000111100011100110110100101110000001110100111011001101111011010010011000100111000001100000011011000110010010000000111001101101001011100000010111001100011011110010110001001100101011100100110001101101001011101000111100100101110011001000110101100111110000010100100001101100001011011000110110000101101010010010100010000111010001000000011010100110111001110000011001000110010001100100011011100110010001110010010110100110100001101100011011000110101011001000011011100110111001101010100000000110101001101110011100000110010001100100011001000110111001100110011001000101101001101000011011000110110001101010110010000110111001101110011001000001010010000110110111101101110011101000110000101100011011101000011101000100000001000000011110001110011011010010111000000111010011101100110111101101001001100010011100000110000001101100011001001000000001100010011100100110010001011100011000100110110001110000010111000110001001011100011001000111010001101010011000000110110001100000011111000111011011001010111100001110000011010010111001001100101011100110011110100110000001110110111000100111101001100000010111000110111001101010011000000001010010001010111100001110000011010010111001001100101011100110011101000100000001100000000101001000011010100110110010101110001001110100010000000110111001101100010000001010010010001010100011101001001010100110101010001000101010100100000101001000011011011110110111001110100011001010110111001110100001011010100110001100101011011100110011101110100011010000011101000100000001100000000101001001101011000010111100000101101010001100110111101110010011101110110000101110010011001000111001100111010001000000011011100110000000010100101010101110011011001010111001000101101010000010110011101100101011011100111010000111010001000000100111001100101011100100110111100100000010100110100100101010000010100000101001100100000010010010101000000100000010100000110100001101111011011100110010100100000010101100110010101110010011100110110100101101111011011100010000000110010001011100011000000101110001101010011000100101110001100010011011000001010");
		String[] arrOfStr = stringData.split("\\r?\\n");
		for (String a : arrOfStr) {
			if (a.contains("INVITE ") || a.contains("ACK ") || a.contains("CANCEL ") || a.contains("BYE ")
					|| a.contains("NOTIFY ") || a.contains("INFO ") || a.contains("REFER ") || a.contains("OPTIONS ")
					|| a.contains("REGISTER ")) {
				getRequestLineInfo(a);
			} else {
				getMessageHeader(a);
			}

		}
		System.out.println(jsonObject.toString());
		System.out.println(new Gson().toJson(sipData));

	}

	public static String binaryToText(String binary) {
		return Arrays.stream(binary.split("(?<=\\G.{8})")).parallel()
				.map(eightBits -> (char) Integer.parseInt(eightBits, 2))
				.collect(StringBuilder::new, StringBuilder::append, StringBuilder::append).toString();
	}

	public static void getRequestLineInfo(String data) {
		jsonObject.addProperty("Method", data.split(" ", 2)[0]);
		sipData.setMethod(data.split(" ", 2)[0]);
		data = data.replace(data.split(" ", 2)[0], "").trim();
		jsonObject.addProperty("Request-URI", data);
		sipData.setRequestURI(data.split(" ", 2)[0]);

	}

	public static void getMessageHeader(String data) {

		jsonObject.addProperty(data.split(":", 2)[0], data.split(":", 2)[1]);
		if (data.contains("Via")) {
			sipData.setVia(data.split(":", 2)[1]);
		}
		if (data.contains("From")) {
			sipData.setFrom(data.split(":", 2)[1]);
		}
		if (data.contains("To")) {
			sipData.setTo(data.split(":", 2)[1]);
		}
		if (data.contains("Call-ID")) {
			sipData.setCallID(data.split(":", 2)[1]);
		}
		if (data.contains("CSeq")) {
			sipData.setcSeq(data.split(":", 2)[1]);
		}
		if (data.contains("Proxy-Authorization")) {
			sipData.setProxyAuthorization(data.split(":", 2)[1]);
		}
		if (data.contains("Content-Type")) {
			sipData.setContentType(data.split(":", 2)[1]);
		}
		if (data.contains("Content-Length")) {
			sipData.setContentLength(data.split(":", 2)[1]);
		}
		if (data.contains("Date")) {
			sipData.setDate(data.split(":", 2)[1]);
		}
		if (data.contains("Contact")) {
			sipData.setContact(data.split(":", 2)[1]);
		}
		if (data.contains("Expires")) {
			sipData.setExpires(data.split(":", 2)[1]);
		}
		if (data.contains("Accept")) {
			sipData.setAccept(data.split(":", 2)[1]);
		}
		if (data.contains("Max-Forwards")) {
			sipData.setMaxForwards(data.split(":", 2)[1]);
		}
		if (data.contains("User-Agent")) {
			sipData.setUserAgent(data.split(":", 2)[1]);
		}
		if (data.contains("Allow")) {
			sipData.setAllow(data.split(":", 2)[1]);
		}

	}

}
